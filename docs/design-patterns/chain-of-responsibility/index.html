<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-design-patterns/behavioral-patterns/chain-of-responsibility" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">责任链模式 | Sol 的空间</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.szdev.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://www.szdev.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://www.szdev.com/docs/design-patterns/chain-of-responsibility"><meta data-rh="true" property="og:locale" content="zh_CN"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="责任链模式 | Sol 的空间"><meta data-rh="true" name="description" content="允许你将请求沿着处理者链进行发送。收到请求后，每个处理者均可对请求进行处理，或将其传递给链上的下个处理者。"><meta data-rh="true" property="og:description" content="允许你将请求沿着处理者链进行发送。收到请求后，每个处理者均可对请求进行处理，或将其传递给链上的下个处理者。"><link data-rh="true" rel="icon" href="/img/favicon_sol.ico"><link data-rh="true" rel="canonical" href="https://www.szdev.com/docs/design-patterns/chain-of-responsibility"><link data-rh="true" rel="alternate" href="https://www.szdev.com/docs/design-patterns/chain-of-responsibility" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://www.szdev.com/docs/design-patterns/chain-of-responsibility" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Sol 的空间 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Sol 的空间 Atom Feed"><link rel="stylesheet" href="/assets/css/styles.2131686c.css">
<script src="/assets/js/runtime~main.057fdd07.js" defer="defer"></script>
<script src="/assets/js/main.5aeaed92.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo_sol.jpg" alt="Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo_sol.jpg" alt="Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">主页</b></a><a class="navbar__item navbar__link" href="/docs/machine-learning/intro">机器学习</a><a class="navbar__item navbar__link" href="/docs/modern-cpp/intro">现代 C++</a><a class="navbar__item navbar__link" href="/docs/modern-linux/intro">现代 Linux</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/design-patterns/intro">设计模式</a><a class="navbar__item navbar__link" href="/docs/android-framework/intro">Android 框架</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/blog">博客</a><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo_sol.jpg" alt="Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo_sol.jpg" alt="Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"><b>主页</b></a><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/design-patterns/intro">设计模式是什么？</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/design-patterns/creational-patterns/">创建型模式</a><button aria-label="展开侧边栏分类 &#x27;创建型模式&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/design-patterns/structural-patterns/">结构型模式</a><button aria-label="展开侧边栏分类 &#x27;结构型模式&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/design-patterns/behavioral-patterns/">行为模式</a><button aria-label="折叠侧边栏分类 &#x27;行为模式&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/design-patterns/chain-of-responsibility">责任链模式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design-patterns/command">命令模式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design-patterns/iterator">迭代器模式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design-patterns/mediator">中介者模式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design-patterns/memento">备忘录模式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design-patterns/observer">  观察者模式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design-patterns/state">状态模式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design-patterns/strategy">策略模式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design-patterns/template-method">模板方法模式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design-patterns/visitor">访问者模式</a></li></ul></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/design-patterns/behavioral-patterns/"><span itemprop="name">行为模式</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">责任链模式</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>责任链模式</h1></header>
<p><strong>亦称：职责链模式、命令链、CoR、Chain of Command、Chain of Responsibility</strong></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="意图"><strong>意图</strong><a href="#意图" class="hash-link" aria-label="意图的直接链接" title="意图的直接链接">​</a></h2>
<p><strong>责任链模式</strong>是一种行为设计模式，允许你将请求沿着处理者链进行发送。收到请求后，每个处理者均可对请求进行处理，或将其传递给链上的下个处理者。</p>
<p><img decoding="async" loading="lazy" src="https://refactoringguru.cn/images/patterns/content/chain-of-responsibility/chain-of-responsibility-2x.png" alt="" class="img_ev3q"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="问题"><strong>问题</strong><a href="#问题" class="hash-link" aria-label="问题的直接链接" title="问题的直接链接">​</a></h2>
<p>  假如你正在开发一个在线订购系统。你希望对系统访问进行限制，只允许认证用户创建订单。此外，拥有管理权限的用户也拥有所有订单的完全访问权限。</p>
<p>简单规划后，你会意识到这些检查必须依次进行。只要接收到包含用户凭据的请求，应用程序就可尝试对进入系统的用户进行认证。但如果由于用户凭据不正确而导致认证失败，那就没有必要进行后续检查了。</p>
<p><img decoding="async" loading="lazy" src="https://refactoringguru.cn/images/patterns/diagrams/chain-of-responsibility/problem1-zh-2x.png" alt="" class="img_ev3q"></p>
<p>请求必须经过一系列检查后才能由订购系统来处理。</p>
<p>在接下来的几个月里，你实现了后续的几个检查步骤。</p>
<ul>
<li>一位同事认为直接将原始数据传递给订购系统存在安全隐患。因此你新增了额外的验证步骤来清理请求中的数据。</li>
<li>过了一段时间，有人注意到系统无法抵御暴力密码破解方式的攻击。为了防范这种情况，你立刻添加了一个检查步骤来过滤来自同一 IP 地址的重复错误请求。</li>
<li>又有人提议你可以对包含同样数据的重复请求返回缓存中的结果，从而提高系统响应速度。因此，你新增了一个检查步骤，确保只有没有满足条件的缓存结果时请求才能通过并被发送给系统。</li>
</ul>
<p><img decoding="async" loading="lazy" src="https://refactoringguru.cn/images/patterns/diagrams/chain-of-responsibility/problem2-zh-2x.png" alt="" class="img_ev3q"></p>
<p>代码变得越来越多，也越来越混乱。</p>
<p>检查代码本来就已经混乱不堪，而每次新增功能都会使其更加臃肿。修改某个检查步骤有时会影响其他的检查步骤。最糟糕的是，当你希望复用这些检查步骤来保护其他系统组件时，你只能复制部分代码，因为这些组件只需部分而非全部的检查步骤。</p>
<p>系统  会变得让人非常费解，而且其维护成本也会激增。你在艰难地和这些代码共处一段时间后，有一天终于决定对整个系统进行重构。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="解决方案"><strong>解决方案</strong><a href="#解决方案" class="hash-link" aria-label="解决方案的直接链接" title="解决方案的直接链接">​</a></h2>
<p>与许多其他行为设计模式一样，<strong>责任链</strong>会将特定行为转换为被称作<em>处理者</em>的独立对象。在上述示例中，每个检查步骤都可被抽取为仅有单个方法的类，并执行检查操作。请求及其数据则会被作为参数传递给该方法。</p>
<p>模式建议你将这些处理者连成一条链。链上的每个处理者都有一个成员变量来保存对于下一处理者的引用。除了处理请求外，处理者还负责沿着链传递请求。请求会在链上移动，直至所有处理者都有机会对其进行处理。</p>
<p>最重要的是：处理者可以决定不再沿着链传递请求，这可高效地取消所有后续处理步骤。</p>
<p>在我们的订购系统示例中，处理者会在进行请求处理工作后决定是否继续沿着链传递请求。如果请求中包含正确的数据，所有处理者都将执行自己的主要行为，无论该行为是身份验证还是数据缓存。</p>
<p><img decoding="async" loading="lazy" src="https://refactoringguru.cn/images/patterns/diagrams/chain-of-responsibility/solution1-zh-2x.png" alt="" class="img_ev3q"></p>
<p>处理者依次排列，组成一条链。</p>
<p>不过还有一种稍微不同的方式 (也是更经典一种)，那就是处理者接收到请求后自行决定是否能够对其进行处理。如果自己能够处理，处理者就不再继续传递请求。因此在这种情况下，每个请求要么最多有一个处理者对其进行处理，要么没有任何处理者对其进行处理。在处理图形用户界面元素栈中的事件时，这 种方式非常常见。</p>
<p>例如，当用户点击按钮时，按钮产生的事件将沿着 GUI 元素链进行传递，最开始是按钮的容器 (如窗体或面板)，直至应用程序主窗口。链上第一个能处理该事件的元素会对其进行处理。此外，该例还有另一个值得我们关注的地方：它表明我们总能从对象树中抽取出链来。</p>
<p><img decoding="async" loading="lazy" src="https://refactoringguru.cn/images/patterns/diagrams/chain-of-responsibility/solution2-zh-2x.png" alt="" class="img_ev3q"></p>
<p>对象树的枝干可以组成一条链。</p>
<p>所有处理者类均实现同一接口是关键所在。每个具体处理者仅关心下一个包含 <code>execute</code> 执行方法的处理者。这样一来，你就可以在运行时使用不同的处理者来创建链，而无需将相关代码与处理者的具体类进行耦合。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="真实世界类比"><strong>真实世界类比</strong><a href="#真实世界类比" class="hash-link" aria-label="真实世界类比的直接链接" title="真实世界类比的直接链接">​</a></h2>
<p><img decoding="async" loading="lazy" src="https://refactoringguru.cn/images/patterns/content/chain-of-responsibility/chain-of-responsibility-comic-1-zh-2x.png" alt="" class="img_ev3q"></p>
<p>给技术支持打电话时你可能得应对多名接听人员。</p>
<p>最近，你刚为自己的电脑购买并安装了一个新的硬件设备。身为一名极客，你显然在电脑上安装了多个操作系统，所以你会试着启动所有操作系统来确认其是否支持新的硬件设备。Windows 检测到了该硬件设备并对其进行了自动启用。但是你喜爱的 Linux 系统并不支持新硬件设备。抱着最后一点希望，你决定拨打包装盒上的技术支持电话。</p>
<p>首先你会听到自动回复器的机器合成语音，它提供了针对各种问题的九个常用解决方案，但其中没有一个与你遇  到的问题相关。过了一会儿，机器人将你转接到人工接听人员处。</p>
<p>这位接听人员同样无法提供任何具体的解决方案。他不断地引用手册中冗长的内容，并不会仔细聆听你的回应。在第 10 次听到“你是否关闭计算机后重新启动呢？”这句话后，你要求与一位真正的工程师通话。</p>
<p>最后，接听人员将你的电话转接给了工程师，他或许正缩在某幢办公大楼的阴暗地下室中，坐在他所深爱的服务器机房里，焦躁不安地期待着同一名真人交流。工程师告诉了你新硬件设备驱动程序的下载网址，以及如何在 Linux 系统上进行安装。问题终于解决了！你挂断了电话，满心欢喜。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="责任链模式结构"><strong>责任链模式结构</strong><a href="#责任链模式结构" class="hash-link" aria-label="责任链模式结构的直接链接" title="责任链模式结构的直接链接">​</a></h2>
<p><img decoding="async" loading="lazy" src="https://refactoringguru.cn/images/patterns/diagrams/chain-of-responsibility/structure-2x.png" alt="" class="img_ev3q"></p>
<ol>
<li>
<p><strong>处理者</strong> (Handler) 声明了所有具体处理者的通用接口。该接口通常仅包含单个方法用于请求处理，但有时其还会包含一个设置链上下个处理者的方法。</p>
</li>
<li>
<p><strong>基础处理者</strong> (Base Handler) 是一个可选的类，你可以将所有处理者共用的样本代码放置在其中。</p>
<p>通常情况下，该类中定义了一个保存对于下个处理者引用的成员变量。客户端可通过将处理者传递给上个处理者的构造函数或设定方法来创建链。该类还可以实现默认的处理行为：确定下个处理者存在后再将请求传递给它。</p>
</li>
<li>
<p><strong>具体处理者</strong> (Concrete Handlers) 包含处理请求的实际代码。每个处理者接收到请求后，都必  须决定是否进行处理，以及是否沿着链传递请求。</p>
<p>处理者通常是独立且不可变的，需要通过构造函数一次性地获得所有必要地数据。</p>
</li>
<li>
<p><strong>客户端</strong> (Client) 可根据程序逻辑一次性或者动态地生成链。值得注意的是，请求可发送给链上的任意一个处理者，而非必须是第一个处理者。</p>
</li>
</ol>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="伪代码"><strong>伪代码</strong><a href="#伪代码" class="hash-link" aria-label="伪代码的直接链接" title="伪代码的直接链接">​</a></h2>
<p>在本例中，<strong>责任链</strong>模式负责为活动的 GUI 元素显示上下文帮助信息。</p>
<p><img decoding="async" loading="lazy" src="https://refactoringguru.cn/images/patterns/diagrams/chain-of-responsibility/example-zh-2x.png" alt="" class="img_ev3q"></p>
<p>GUI 类使用组合模式生成。每个元素都链接到自己的容器元素。你可随时构建从当前元素开始的、遍历其所有容器的元素链。</p>
<p>应用程序的 GUI 通常为对象树结构。例如，负责渲染程序主窗口的 <code>对话框</code> 类就是对象树的根节点。对话框包含 <code>面板</code>，而面板可能包含其他面板，或是 <code>按钮</code> 和 <code>文本框</code> 等下层元素。</p>
<p>只要给一个简单的组件指定帮助文本，它就可显示简短的上下文提示。但更复杂的组件可自定义上下文帮助文本的显示方式，例如显示手册摘录内容或在浏览器中打开一个网页。</p>
<p><img decoding="async" loading="lazy" src="https://refactoringguru.cn/images/patterns/diagrams/chain-of-responsibility/example2-zh-2x.png" alt="" class="img_ev3q"></p>
<p>帮助请求如何在 GUI 对象中移动。</p>
<p>当用户将鼠标指针移动到某个元素并按下 <code>F1</code> 键时，程序检测到指针下的组件并对其发送帮助请求。该请求不断向上传递到该元素所有的 容器，直至某个元素能够显示帮助信息。</p>
<p>`// 处理者接口声明了一个创建处理者链的方法。还声明了一个执行请求的方法。 <strong>interface</strong> <strong>ComponentWithContextualHelp</strong> <strong>ismethod</strong> showHelp()</p>
<p>// 简单组件的基础类。 <strong>abstract class</strong> <strong>Component</strong> <strong>implements</strong> ComponentWithContextualHelp <strong>isfield</strong> tooltipText：string</p>
<p>// 组件容器在处理者链中作为“下一个”链接。
<strong>protected</strong> <strong>field</strong> container: Container</p>
<p>// 如果组件设定了帮助文字，那它将会显示提示信息。如果组件没有帮助文字
// 且其容器存在，那它会将调用传递给容器。
<strong>method</strong> showHelp() <strong>isif</strong> (tooltipText != <strong>null</strong>)
// 显示提示信息。
<strong>else</strong>container.showHelp()</p>
<p>// 容器可以将简单组件和其他容器作为其子项目。链关系将在这里建立。该类将从 // 其父类处继承 showHelp (显示帮助) 的行为。 <strong>abstract class</strong> <strong>Container</strong> <strong>extends</strong> Component <strong>isprotected</strong> <strong>field</strong> children：array of Component</p>
<p><strong>method</strong> add(child) <strong>is</strong>children.add(child)
child.container = <strong>this</strong>// 原始组件应该能够使用帮助操作的默认实现……</p>
<p><strong>class</strong> <strong>Button</strong> <strong>extends</strong> Component <strong>is</strong>// ……</p>
<p>// 但复杂组件可能会对默认实现进行重写。如果无法以新的方式来提供帮助文字，// 那组件总是还能调用基础实现的 (参见 Component 类)。 <strong>class</strong> <strong>Panel</strong> <strong>extends</strong> Container <strong>isfield</strong> modalHelpText：string</p>
<p><strong>method</strong> showHelp() <strong>isif</strong> (modalHelpText != <strong>null</strong>)
// 显示包含帮助文字的模态窗口。
<strong>elsesuper</strong>.showHelp()</p>
<p>// ……同上…… <strong>class</strong> <strong>Dialog</strong> <strong>extends</strong> Container <strong>isfield</strong> wikiPageURL：string</p>
<p><strong>method</strong> showHelp() <strong>isif</strong> (wikiPageURL != <strong>null</strong>)
// 打开百科帮助页面。
<strong>elsesuper</strong>.showHelp()</p>
<p>// 客户端代码。 <strong>class</strong> <strong>Application</strong> <strong>is</strong>// 每个程序都能以不同方式对链进行配置。 <strong>method</strong> createUI() <strong>is</strong>dialog = <strong>new</strong> Dialog (“预算报告”) dialog.wikiPageURL = “http://……”panel = <strong>new</strong> Panel(0，0，400，800) panel.modalHelpText = “本面板用于……”ok = <strong>new</strong> Button(250，760，50，20，“确认”) ok.tooltipText = “这是一个确认按钮……”cancel = <strong>new</strong> Button(320，760，50，20，“取消”) // …… panel.add(ok) panel.add(cancel) dialog.add(panel)</p>
<p>// 想象这里会发生什么。
<strong>method</strong> onF1KeyPress() <strong>is</strong>component = <strong>this</strong>.getComponentAtMouseCoords()
component.showHelp()`</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="责任链模式适合应用场景"><strong>责任链模式适合应用场景</strong><a href="#责任链模式适合应用场景" class="hash-link" aria-label="责任链模式适合应用场景的直接链接" title="责任链模式适合应用场景的直接链接">​</a></h2>
<p><strong>当程序需要使用不同方式处理不同种类请求，而且请求类型和顺序预先未知时，可以使用责任链模式。</strong></p>
<p>该模式能将多个处理者连接成一条链。接收到请求后，它会“询问”每个处理者是否能够对其进行处理。这样所有处理者都有机会来处理请求。</p>
<p><strong>当必须按顺序执行多个处理者时，可以使用该模式。</strong></p>
<p>无论 你以何种顺序将处理者连接成一条链，所有请求都会严格按照顺序通过链上的处理者。</p>
<p><strong>如果所需处理者及其顺序必须在运行时进行改变，可以使用责任链模式。</strong></p>
<p>如果在处理者类中有对引用成员变量的设定方法，你将能动态地插入和移除处理者，或者改变其顺序。</p>
<p><strong>实现方式</strong></p>
<ol>
<li>声明处理者接口并描述请求处理方法的签名。确定客户端如何将请求数据传递给方法。最灵活的方式是将请求转换为对象，然后将其以参数的形式传递给处理函数。</li>
<li>为了在具体处理者中消除重复的样本代码，你可以根据处理者接口创建抽象处理者基类。该类需要有一个成员变量来存储指向链上下个处理者的引用。你可以将其设置为不可变类。但如果你打算在运行时对链进行改变，则需要定义一个设定方法来修改引用成员变量的值。为了使用方便，你还可以实现处理方法的默认行为。如果还有剩余对象，该方法会将请求传递给下个对象。具体处理者还能够通过调用父对象的方法来使用这一行为。</li>
<li>依次创建具体处理者子类并实现其处理方法。每个处理者在接收到请求后都必须做出两个决定：<!-- -->
<ul>
<li>是否自行处理这个请求。</li>
<li>是否将该请求沿着链进行传递。</li>
</ul>
</li>
<li>客户端可以自行组装链，或者从其他对象处获得预先组装好的链。在后一种情况下，你必须实现工厂类以根据配置或环境设置来创建链。</li>
<li>客户端可以触发链中的任意处理者，而不仅仅是第一个。请求将通过链进行传递，直至某个处理者拒绝继续传递，或者请求到达链尾。</li>
<li>由于链的动态性，客户端需要准备好处理以下情况：<!-- -->
<ul>
<li>链中可能只有单个链接。</li>
<li>部分请求可能无法到达链尾。</li>
<li>其他请求可能直到链尾都未被处理。</li>
</ul>
</li>
</ol>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="责任链模式优缺点"><strong>责任链模式优缺点</strong><a href="#责任链模式优缺点" class="hash-link" aria-label="责任链模式优缺点的直接链接" title="责任链模式优缺点的直接链接">​</a></h2>
<p>✔️ 你可以控制请求处理的顺序。</p>
<p>✔️ <em>单一职责原则</em>。你可对发起操作和执行操作的类进行解耦。</p>
<p>✔️ <em>开闭原则</em>。你可以在不更改现有代码的情况下在程序中新增处理者。</p>
<p>❌ 部分请求可能未被处理。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="与其他模式的关系"><strong>与其他模式的关系</strong><a href="#与其他模式的关系" class="hash-link" aria-label="与其他模式的关系的直接链接" title="与其他模式的关系的直接链接">​</a></h2>
<ul>
<li><a href="/docs/design-patterns/chain-of-responsibility"><strong>责任链模式</strong></a>、<a href="/docs/design-patterns/command"><strong>命令模式</strong></a>、<a href="/docs/design-patterns/mediator"><strong>中介者模式</strong></a>和<a href="/docs/design-patterns/observer"><strong>观察者模式</strong></a>用于处理请求发送者和接收者之间的不同连接方式：<!-- -->
<ul>
<li><em>责任链</em>按照顺序将请求动态传递给一系列的潜在接收者，直至其中一名接收者对请求进行处理。</li>
<li><em>命令</em>在发送者和请求者之间建立单向连接。</li>
<li><em>中介者</em>清除了发送者和请求者之间的直接连接，强制它们通过一个中介对象进行间接沟通。</li>
<li><em>观察者</em>允许接收者动态地订阅或取消接收请求。</li>
</ul>
</li>
<li><a href="/docs/design-patterns/chain-of-responsibility"><strong>责任链</strong></a>通常和<a href="/docs/design-patterns/composite"><strong>组合模式</strong></a>结合使用。在这种情  况下，叶组件接收到请求后，可以将请求沿包含全体父组件的链一直传递至对象树的底部。</li>
<li><a href="/docs/design-patterns/chain-of-responsibility"><strong>责任链</strong></a>的管理者可使用<a href="/docs/design-patterns/command"><strong>命令模式</strong></a>实现。在这种情况下，你可以对由请求代表的同一个上下文对象执行许多不同的操作。还有另外一种实现方式，那就是请求自身就是一个<em>命令</em>对象。在这种情况下，你可以对由一系列不同上下文连接而成的链执行相同的操作。</li>
<li><a href="/docs/design-patterns/chain-of-responsibility"><strong>责任链</strong></a>和<a href="/docs/design-patterns/decorator"><strong>装饰模式</strong></a>的类结构非常相似。两者都依赖递归组合将需要执行的操作传递给一系列对象。但是，两者有几点重要的不同之处。 <a href="/docs/design-patterns/chain-of-responsibility"><strong>责任链</strong></a>的管理者可以相互独立地执行一切操作，还可以随时停止传递请求。另一方面，各种<em>装饰</em>可以在遵循基本接口的情况下扩展对象的行为。此外，装饰无法中断请求的传递。</li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/design-patterns/behavioral-patterns/"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">行为模式</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/design-patterns/command"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">命令模式</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#意图" class="table-of-contents__link toc-highlight"><strong>意图</strong></a></li><li><a href="#问题" class="table-of-contents__link toc-highlight"><strong>问题</strong></a></li><li><a href="#解决方案" class="table-of-contents__link toc-highlight"><strong>解决方案</strong></a></li><li><a href="#真实世界类比" class="table-of-contents__link toc-highlight"><strong>真实世界类比</strong></a></li><li><a href="#责任链模式结构" class="table-of-contents__link toc-highlight"><strong>责任链模式结构</strong></a></li><li><a href="#伪代码" class="table-of-contents__link toc-highlight"><strong>伪代码</strong></a></li><li><a href="#责任链模式适合应用场景" class="table-of-contents__link toc-highlight"><strong>责任链模式适合应用场景</strong></a></li><li><a href="#责任链模式优缺点" class="table-of-contents__link toc-highlight"><strong>责任链模式优缺点</strong></a></li><li><a href="#与其他模式的关系" class="table-of-contents__link toc-highlight"><strong>与其他模式的关系</strong></a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">本站构建</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/docusaurus-mdx/intro">Docusaurus 特性</a></li><li class="footer__item"><a href="https://docusaurus.io/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus 官方文档<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://mdxjs.com/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">MDX 官方文档<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/latex">Latex 语法</a></li><li class="footer__item"><a href="https://github.com/ShangjinTang/site" target="_blank" rel="noopener noreferrer" class="footer__link-item">网站托管 GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">常用链接</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Google<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/license">版权声明</a></li><li class="footer__item"><a class="footer__link-item" href="/about-site">关于本站</a></li><li class="footer__item"><a class="footer__link-item" href="/contact-me">联系信息</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 by Sol</div></div></div></footer></div>
</body>
</html>